<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Pastel - Sistema de Pedidos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .navbar-brand { font-weight: bold; color: #d63384 !important; }
        .hero-section { background: linear-gradient(135deg,#fff0f6 0%,#fffaf6 100%); border-radius:15px; padding:3rem 2rem; margin:2rem 0; }
        .card { border:none; border-radius:15px; box-shadow:0 4px 15px rgba(214,51,132,0.1); transition:transform 0.3s ease; }
        .card:hover { transform: translateY(-5px); }
        .btn-primary { background: linear-gradient(135deg,#ff66b2,#d63384); border:none; border-radius:25px; padding:12px 30px; font-weight:bold; }
        .btn-primary:hover { background:linear-gradient(135deg,#e60073,#c2185b); transform:scale(1.05); }
        .form-section { background:white; border-radius:15px; padding:2rem; margin:1rem 0; box-shadow:0 2px 10px rgba(0,0,0,0.1); }
        .price-display { background:#fff0f6; border-radius:10px; padding:15px; margin:10px 0; border-left:4px solid #d63384; }
        .nav-pills .nav-link.active { background:linear-gradient(135deg,#ff66b2,#d63384)!important; }
        .form-label { font-weight:600; color:#495057; margin-bottom:0.5rem; }
        .form-control:focus, .form-select:focus { border-color:#d63384; box-shadow:0 0 0 0.2rem rgba(214,51,132,0.25); }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light" style="background-color:#fff0f6;">
    <div class="container">
        <div class="navbar-nav ms-auto">
            <a class="nav-link" href="/admin" style="color:#d63384;">
                <i class="fas fa-chart-bar"></i> Panel Administración
            </a>
        </div>
    </div>
</nav>

<div class="container">
    <div class="hero-section text-center">
        <h1 class="display-4" style="color:#d63384;"><i class="fas fa-birthday-cake"></i> Mi Pastel</h1>
        <p class="lead" style="color:#666;">Sistema de ingreso de pedidos</p>
    </div>

    <ul class="nav nav-pills nav-justified mb-4" id="myTab" role="tablist">
        <li class="nav-item"><button class="nav-link active" id="normales-tab" data-bs-toggle="tab" data-bs-target="#normales" type="button">Pasteles Normales</button></li>
        <li class="nav-item"><button class="nav-link" id="clientes-tab" data-bs-toggle="tab" data-bs-target="#clientes" type="button">Pedidos de Clientes</button></li>
    </ul>

    <div class="tab-content" id="myTabContent">

        <!-- ===================== -->
        <!-- PASTELES NORMALES -->
        <!-- ===================== -->
        <div class="tab-pane fade show active" id="normales" role="tabpanel">
            <div class="form-section">
                <h4 class="mb-4" style="color:#d63384;">Ingresar Pastel Normal</h4>
                <form id="formNormal" action="/normales/registrar" method="post">
                    <div class="row g-3">
                        <!-- Sabor -->
                        <div class="col-md-6">
                            <label class="form-label">Sabor</label>
                            <select class="form-select" name="sabor" id="saborNormal" required>
                                <option value="">Seleccionar sabor...</option>
                                {% for sabor in sabores_normales %}
                                <option value="{{ sabor }}">{{ sabor }}</option>
                                {% endfor %}
                            </select>
                            <input type="text" class="form-control mt-2 d-none" name="sabor_otro" id="saborOtroNormal" placeholder="Escriba el sabor personalizado">
                        </div>

                        <!-- Tamaño -->
                        <div class="col-md-6">
                            <label class="form-label">Tamaño</label>
                            <select class="form-select" name="tamano" id="tamanoNormal" required>
                                <option value="">Seleccionar tamaño...</option>
                                {% for tamano in tamanos_normales %}
                                <option value="{{ tamano }}">{{ tamano }}</option>
                                {% endfor %}
                            </select>
                            <input type="text" class="form-control mt-2 d-none" name="tamano_otro" id="tamanoOtroNormal" placeholder="Ingrese tamaño personalizado">
                        </div>

                        <!-- Cantidad -->
                        <div class="col-md-4">
                            <label class="form-label">Cantidad</label>
                            <input type="number" class="form-control" name="cantidad" id="cantidadNormal" value="1" min="1" required>
                        </div>

                        <!-- Sucursal -->
                        <div class="col-md-8">
                            <label class="form-label">Sucursal</label>
                            <select class="form-select" name="sucursal" required>
                                <option value="">Seleccionar sucursal...</option>
                                {% for sucursal in sucursales %}
                                <option value="{{ sucursal }}">{{ sucursal }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <!-- Precio -->
                    <div class="price-display mt-3">
                        <div class="row">
                            <div class="col-md-6"><strong>Precio unitario:</strong> <span id="precioUnitarioNormal">Q0.00</span></div>
                            <div class="col-md-6"><strong>Total:</strong> <span id="precioTotalNormal" style="color:#d63384; font-weight:bold;">Q0.00</span></div>
                        </div>
                        <input type="number" class="form-control mt-2 d-none" name="precio_personalizado" id="precioOtroNormal" placeholder="Ingrese precio manual">
                    </div>

                    <div class="mt-4"><button type="submit" class="btn btn-primary btn-lg w-100"><i class="fas fa-save"></i> Registrar Pastel Normal</button></div>
                </form>
            </div>
        </div>

        <!-- ===================== -->
        <!-- PEDIDOS CLIENTES -->
        <!-- ===================== -->
        <div class="tab-pane fade" id="clientes" role="tabpanel">
            <div class="form-section">
                <h4 class="mb-4" style="color:#d63384;">Ingresar Pedido de Cliente</h4>
                <form id="formCliente" action="/clientes/registrar" method="post" enctype="multipart/form-data">
                    <div class="row g-3">
                        <!-- Sabor -->
                        <div class="col-md-6">
                            <label class="form-label">Sabor</label>
                            <select class="form-select" name="sabor" id="saborCliente" required>
                                <option value="">Seleccionar sabor...</option>
                                {% for sabor in sabores_clientes %}
                                <option value="{{ sabor }}">{{ sabor }}</option>
                                {% endfor %}
                            </select>
                            <input type="text" class="form-control mt-2 d-none" name="sabor_otro" id="saborOtroCliente" placeholder="Escriba el sabor personalizado">
                        </div>

                        <!-- Tamaño -->
                        <div class="col-md-6">
                            <label class="form-label">Tamaño</label>
                            <select class="form-select" name="tamano" id="tamanoCliente" required>
                                <option value="">Seleccionar tamaño...</option>
                                {% for tamano in tamanos_clientes %}
                                <option value="{{ tamano }}">{{ tamano }}</option>
                                {% endfor %}
                            </select>
                            <input type="text" class="form-control mt-2 d-none" name="tamano_otro" id="tamanoOtroCliente" placeholder="Ingrese tamaño personalizado">
                        </div>

                        <!-- Cantidad -->
                        <div class="col-md-4">
                            <label class="form-label">Cantidad</label>
                            <input type="number" class="form-control" name="cantidad" id="cantidadCliente" value="1" min="1" required>
                        </div>

                        <!-- Sucursal -->
                        <div class="col-md-8">
                            <label class="form-label">Sucursal</label>
                            <select class="form-select" name="sucursal" required>
                                <option value="">Seleccionar sucursal...</option>
                                {% for sucursal in sucursales %}
                                <option value="{{ sucursal }}">{{ sucursal }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="col-md-6"><label class="form-label">Fecha de entrega</label><input type="date" class="form-control" name="fecha_entrega" id="fechaEntrega" required></div>
                        <div class="col-md-6"><label class="form-label">Color (opcional)</label><input type="text" class="form-control" name="color" placeholder="Ej: Rosado, Azul..."></div>

                        <div class="col-md-12"><label class="form-label">Foto (opcional)</label><input type="file" class="form-control" name="foto" accept="image/*"><small class="text-muted">Formatos aceptados: JPG, PNG, GIF</small></div>

                        <div class="col-md-12"><label class="form-label">Dedicatoria</label><textarea class="form-control" name="dedicatoria" rows="2" placeholder="Dedicatoria especial del pedido..."></textarea></div>

                        <div class="col-md-12"><label class="form-label">Detalles</label><textarea class="form-control" name="detalles" rows="2" placeholder="Detalles adicionales del pedido..."></textarea></div>
                    </div>

                    <!-- Precio -->
                    <div class="price-display mt-3">
                        <div class="row">
                            <div class="col-md-6"><strong>Precio unitario:</strong> <span id="precioUnitarioCliente">Q0.00</span></div>
                            <div class="col-md-6"><strong>Total:</strong> <span id="precioTotalCliente" style="color:#d63384; font-weight:bold;">Q0.00</span></div>
                        </div>
                        <input type="number" class="form-control mt-2 d-none" name="precio_personalizado" id="precioOtroCliente" placeholder="Ingrese precio manual">
                    </div>

                    <div class="mt-4"><button type="submit" class="btn btn-primary btn-lg w-100"><i class="fas fa-save"></i> Registrar Pedido de Cliente</button></div>
                </form>
            </div>
        </div>
    </div>
</div>

<footer class="bg-light text-center py-4 mt-5"><p class="mb-0" style="color:#666;"><i class="fas fa-cake"></i> Mi Pastel - Sistema de Pedidos</p></footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // --- Mostrar campos "Otro" ---
    function toggleOtro(selectId, inputId, priceInputId) {
        const select = document.getElementById(selectId);
        const input = document.getElementById(inputId);
        const priceInput = document.getElementById(priceInputId);
        if (select.value === "Otro") {
            input.classList.remove("d-none");
            priceInput.classList.remove("d-none");
        } else {
            input.classList.add("d-none");
            priceInput.classList.add("d-none");
        }
    }

    // --- Escuchar cambios (normales y clientes) ---
    ["Normal", "Cliente"].forEach(tipo => {
        document.getElementById("sabor" + tipo).addEventListener("change", () =>
            toggleOtro("sabor" + tipo, "saborOtro" + tipo, "precioOtro" + tipo)
        );
        document.getElementById("tamano" + tipo).addEventListener("change", () =>
            toggleOtro("tamano" + tipo, "tamanoOtro" + tipo, "precioOtro" + tipo)
        );
    });

    // --- Actualización automática de precios ---
    async function actualizarPrecio(tipo) {
        const sabor = document.getElementById("sabor" + tipo).value;
        const tamano = document.getElementById("tamano" + tipo).value;
        const cantidad = parseFloat(document.getElementById("cantidad" + tipo).value) || 1;
        const precioUnitarioEl = document.getElementById("precioUnitario" + tipo);
        const precioTotalEl = document.getElementById("precioTotal" + tipo);
        const precioManualEl = document.getElementById("precioOtro" + tipo);

        if (!sabor || !tamano) return;

        const resp = await fetch(`/api/obtener-precio?sabor=${encodeURIComponent(sabor)}&tamano=${encodeURIComponent(tamano)}`);
        const data = await resp.json();

        if (data.encontrado) {
            precioUnitarioEl.textContent = "Q" + data.precio.toFixed(2);
            precioTotalEl.textContent = "Q" + (data.precio * cantidad).toFixed(2);
            precioManualEl.classList.add("d-none");
        } else {
            precioUnitarioEl.textContent = "Q0.00";
            precioTotalEl.textContent = "Q0.00";
            precioManualEl.classList.remove("d-none");
        }
    }

    ["Normal", "Cliente"].forEach(tipo => {
        document.getElementById("sabor" + tipo).addEventListener("change", () => actualizarPrecio(tipo));
        document.getElementById("tamano" + tipo).addEventListener("change", () => actualizarPrecio(tipo));
        document.getElementById("cantidad" + tipo).addEventListener("input", () => actualizarPrecio(tipo));
    });

    // --- Fecha mínima ---
    document.addEventListener("DOMContentLoaded", () => {
        const hoy = new Date().toISOString().split("T")[0];
        document.getElementById("fechaEntrega")?.setAttribute("min", hoy);
    });
</script>
</body>
</html>

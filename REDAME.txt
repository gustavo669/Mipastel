ğŸ§ Sistema de GestiÃ³n de Pedidos "Mi Pastel" v4.0

"Mi Pastel" es un sistema de gestiÃ³n de pedidos hÃ­brido diseÃ±ado para pastelerÃ­as. Combina una aplicaciÃ³n web (FastAPI) para que las sucursales ingresen pedidos y una potente aplicaciÃ³n de escritorio (PySide6) para que la administraciÃ³n central gestione ventas, precios y reportes.

ğŸŒŸ CaracterÃ­sticas Principales

El sistema estÃ¡ dividido en dos componentes principales que se ejecutan simultÃ¡neamente:

1. AplicaciÃ³n de AdministraciÃ³n (Escritorio - PySide6)

Es el centro de control para los administradores.

Interfaz Moderna: Tema oscuro completo (estilo "Dracula" Morado/Rosado) con fuentes limpias (Segoe UI / Lato).

GestiÃ³n CRUD Completa: Funcionalidad total de Crear, Leer, Editar y Eliminar para pedidos Normales y de Clientes.

GestiÃ³n de Precios Centralizada: Un diÃ¡logo emergente (âš™ï¸ Administrar Precios) permite editar la lista de precios maestra directamente en la base de datos.

Filtrado Avanzado: Permite filtrar los pedidos por fecha y por sucursal.

Reportes PDF Avanzados: Genera dos tipos de reportes en PDF:

Reporte de Clientes: Un listado detallado con columnas personalizadas (Sabor, ID, Cantidad, Sucursal, Detalles, etc.).

Reporte de Normales: Incluye dos tablas pivot:

Una tabla de Sabor-TamaÃ±o vs. Sucursales (excluyendo medias planchas).

Una tabla de Total por Sabor vs. Sucursales (incluyendo todos los tamaÃ±os) con una fila de "TOTAL GENERAL".

2. AplicaciÃ³n Web (Servidor - FastAPI)

Es la interfaz ligera que usan las sucursales para ingresar nuevos pedidos.

Formularios de Ingreso: PÃ¡ginas separadas para "Pasteles Normales" y "Pedidos de Clientes".

CÃ¡lculo AutomÃ¡tico de Precios: Los formularios consultan la base de datos en tiempo real para calcular el precio unitario y total.

Subida de ImÃ¡genes: El formulario de clientes permite adjuntar una foto para el pedido, la cual se guarda en el servidor.

ValidaciÃ³n: El backend valida los datos antes de ingresarlos a la base de datos.

3. Base de Datos (SQL Server)

Arquitectura de Doble Base de Datos:

MiPastel: Almacena PastelesNormales y la lista maestra PastelesPrecios.

MiPastel_Clientes: Almacena PastelesClientes.

Triggers SQL: Un trigger en la tabla PastelesClientes calcula automÃ¡ticamente la columna total (cantidad * precio) al insertar o actualizar un pedido, asegurando la integridad de los datos.

IDs Personalizados: Todos los pedidos (normales y clientes) inician con un ID de 5 dÃ­gitos (IDENTITY(10000, 1)).

4. Arquitectura de CÃ³digo

ConfiguraciÃ³n Centralizada (config.py): Un Ãºnico archivo define las listas maestras de SUCURSALES, SABORES y TAMANOS. Esto permite que la app web, la app de admin y los reportes usen exactamente los mismos datos.

Lanzador Unificado (run.py): Un script principal que inicia el servidor web FastAPI en un subproceso y luego lanza la aplicaciÃ³n de escritorio PySide6. Al cerrar la ventana de admin, el servidor tambiÃ©n se detiene.

ğŸ› ï¸ TecnologÃ­as Utilizadas

Backend (Servidor Web): FastAPI, Uvicorn

Frontend (App Admin): PySide6 (Qt for Python)

Base de Datos: SQL Server (conectado vÃ­a pyodbc)

Reportes: ReportLab

Lenguaje: Python 3

ğŸ“‚ Estructura del Proyecto

/Mipastel/
â”‚
â”œâ”€â”€ admin/
â”‚   â”œâ”€â”€ admin_app.py     # AplicaciÃ³n principal de admin (UI y lÃ³gica)
â”‚   â””â”€â”€ dialogos.py      # DiÃ¡logos emergentes (Nuevo/Editar/Precios)
â”‚
â”œâ”€â”€ routers/
â”‚   â”œâ”€â”€ admin.py         # Endpoints API para la app de admin
â”‚   â”œâ”€â”€ clientes.py      # Endpoints para el formulario web de clientes
â”‚   â””â”€â”€ normales.py      # Endpoints para el formulario web de normales
â”‚
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ index.html       # Formulario web principal
â”‚   â”œâ”€â”€ exito.html       # PÃ¡gina de "Pedido guardado"
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ static/
â”‚   â””â”€â”€ uploads/         # AquÃ­ se guardan las fotos de clientes
â”‚
â”œâ”€â”€ app.py               # Servidor Web FastAPI (app principal)
â”œâ”€â”€ config.py            # Listas maestras (Sabores, Sucursales)
â”œâ”€â”€ database.py          # LÃ³gica de conexiÃ³n y CRUD con SQL Server
â”œâ”€â”€ reportes.py          # LÃ³gica de generaciÃ³n de PDFs con ReportLab
â”œâ”€â”€ run.py               # El lanzador que inicia todo
â”œâ”€â”€ mipastel_db_v3.1.sql # Script para crear la base de datos
â””â”€â”€ requirements.txt     # Dependencias del proyecto


ğŸš€ CÃ³mo Ejecutar el Proyecto

Clonar el Repositorio

git clone [URL_DEL_REPOSITORIO]
cd Mipastel


Crear Entorno Virtual

python -m venv venv
venv\Scripts\activate  # En Windows


Instalar Dependencias
AsegÃºrate de tener todas las dependencias listadas en requirements.txt:

pip install -r requirements.txt


Configurar la Base de Datos

Abre tu gestor de SQL Server (como SSMS).

Ejecuta el script mipastel_db_v3.1.sql para crear las dos bases de datos (MiPastel y MiPastel_Clientes) y todas sus tablas, triggers y precios.

Verificar la ConexiÃ³n

Abre el archivo database.py.

Verifica que las variables SERVER y DRIVER coincidan con tu configuraciÃ³n local de SQL Server. Por defecto, usa (localdb)\MSSQLLocalDB y ODBC Driver 17 for SQL Server.

Â¡Ejecutar!
Usa el lanzador principal para iniciar el servidor y la app de admin al mismo tiempo:

python run.py


El servidor web estarÃ¡ disponible en http://127.0.0.1:5000.

La aplicaciÃ³n de administraciÃ³n se abrirÃ¡ automÃ¡ticamente.